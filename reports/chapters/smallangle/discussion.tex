\section{Results \& Discussion}
The aim of this work was to produce a well parallelised software capable of quickly producing starting structures for later molecular dynamics simulations of multiple micellar species from small angle scattering data.

\subsection{Parallelisation}
The parallelisation of a software package is commonly assessed using two metrics, strong and weak scaling.
These assess the CPU-bound efficiency and memory-bound efficiency of the software respectively.
A perfectly parallelised software would present a strong and weak scaling efficiency of 1 regardless of the number of processors.

In order to determine the strong scaling relationship for \texttt{fitoog}, a system was set up with a population size of 128 and was run for 5000 iterations steps.
This system was run on a range of processor counts, from 1 to 128 increasing in a $\log_2$ fashion, on the SCARF cluster of STFC.
Figure~\ref{fig:scale}(a) shows the strong scaling relationship for \texttt{fitoog} running on upto 128 cores.
The weak scaling was probed by increasing the population size alongside the number of processors, both were varied in the same range as for the strong scaling, e.g. a population of 1 on a single core upto a population of 128 over 128 cores.
The weak scaling relationship is shown in Figure~\ref{fig:scale}(b).
%
\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{smallangle/scaling}
    \caption{The (a) strong and (b) weak scaling relationships of \texttt{fitoog} running on upto 128 cores of the SCARF cluster.}
    \label{fig:scale}
\end{figure}
%

It can be seen that both the strong and weak parallel efficiency of \texttt{fitoog} are relatively good, with the efficiency not dropping below \SI{80}{\percent} even when spread over 128 cores.
The speedup of \texttt{fitoog} is shown in Figure~\ref{fig:speedup} (this is generated from the strong scaling relationship), from Amdahl's law \cite{amdahl_validity_1967} we can find that the parallel component of a given \texttt{fitoog} run makes up \SI{99.8}{\percent} of the computation.
This suggests that the parallelisation methodology currently implimented is successful, and it would not be advantageous to utilities the more sophisticated parallelisation method outlined in Section~\ref{sec:para}.
%
\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{smallangle/speedup}
    \caption{The speed up of \texttt{fitoog} running on upto 128 cores of the SCARF cluster, the blue dots show the speedup at different compute size, the orange line indicates the theoretical maximum, and the blue line shows the fitting Amdahl's law to the measured speedup \cite{amdahl_validity_1967}.}
    \label{fig:speedup}
\end{figure}
%

The high efficiency in both strong and weak scaling regimes and the indication that the serial component of the computation is very small indicates that it is sensible to utilise high-performance computing resources for this software package.
In the real data application of this work, the \texttt{fitoog} software was run on 48 cores of the SCARF cluster.
This was chosen as it would spread the computation over exactly two nodes of the SCARF cluster (each node contains 24 cores), therefore both nodes are being used to their full capacity.

\subsection{Test system}
In order to assess the PSO implimentation, a simple test system was defined.
This was consisted of a coordinated cell that contained four surfactant molecules at four corners of a \SI{20}{\angstrom} cube, each orientated in a different direction (Figures~\ref{fig:test}(a-c)).
The scattering intensity was calculated from the cell, with the blue beads given a scattering length of \SI{100}{\femto\meter} and the grey beads a scattering length of \SI{20}{\femto\meter}, to ensure the presence of intensity scattering.
The scattering was calculated using the Debye equation \cite{debye_zerstreuung_1915} for values of $q$ in a range from \SIrange{0.3}{1.5}{\per\angstrom} with 100 data points, this profile is shown in Figure~\ref{fig:test}(d).
%
\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{smallangle/fake_box}
    \includegraphics[width=0.8\textwidth]{smallangle/fake}
    \caption{Test system coordinated cell observed down the (a) \emph{x}-, (b) \emph{y}, and (c) \emph{z}-axis, and the calculated scattering data from the Debye equation.}
    \label{fig:test}
\end{figure}
%

\texttt{fitoog} was used, without the energy minimisation capability, to fit the ``experimental'' data; a population size of 100 was iterated over 5000 steps.
Ten repetitions of the \texttt{fitoog} run were performed, taking around two and a half minutes per run on a workstation computer with four cores.
Figure~\ref{fig:test_assess} shows the optimised scattering profile obtained from each of the runs and compares with the ``experimental'' data.
It is clear that some of the runs agree well with the data, in particular runs 1 and 2, the resulting coordinate cell for these profiles are shown in Figure~\ref{fig:fake_result}.
%
\begin{figure}
    \centering
    \includegraphics[width=0.4\textwidth]{smallangle/fake_assess1}
    \includegraphics[width=0.4\textwidth]{smallangle/fake_assess2} \\
    \includegraphics[width=0.4\textwidth]{smallangle/fake_assess3}
    \includegraphics[width=0.4\textwidth]{smallangle/fake_assess4} \\
    \includegraphics[width=0.4\textwidth]{smallangle/fake_assess5}
    \includegraphics[width=0.4\textwidth]{smallangle/fake_assess6} \\
    \includegraphics[width=0.4\textwidth]{smallangle/fake_assess7}
    \includegraphics[width=0.4\textwidth]{smallangle/fake_assess8} \\
    \includegraphics[width=0.4\textwidth]{smallangle/fake_assess9}
    \includegraphics[width=0.4\textwidth]{smallangle/fake_assess10}
    \caption{The best fit from the \texttt{fitoog} run (orange line) is compared with the ``real experimental'' data (blue line) for each of the ten runs.}
    \label{fig:test_assess}
\end{figure}
%
%
\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{smallangle/fake_result}
    \caption{The result of runs 1 (a, b, and c) and 2 (d, e, and f) the test system coordinated cell.}
    \label{fig:fake_result}
\end{figure}
%

This agreement with the data in short runs is a positive result, and the resulting cells shown in Figure~\ref{fig:fake_result} appears to shown some agreement with the coordination cell from which the ``experimental'' data was found.
Therefore, the use a PSO method was continued and applied to the real experimental data.

\subsection{Real data}
\label{sec:real_data}
This real experimental data consisted of a single small angle neutron scattering profile for the hydrogenated \ce{C_{10}TA+} micelle, with \ce{NO3-} counter ions in \ce{D2O}.
It was assumed that this data was completely background subtracted such that the scattering present was a result of the micelles alone.
Figure~\ref{fig:expdata} shows the scattering profile that was being modelled.
%
\begin{figure}
    \centering
    \includegraphics[width=0.8\textwidth]{smallangle/exp_data}
    \caption{The experimental data to which teh real \texttt{fitoog} run was attempting to fit.}
    \label{fig:expdata}
\end{figure}
%

The aim of the application to real data was to attempt to quickly produce a system with multiple micellar species.
Therefore, the simulation cell was substantially larger; containing 500 MARTINI coarse-grained \ce{C_{10}TA+} and \ce{NO3-} molecules, the available cell was a cube with a side \SI{177}{\angstrom} in length.
Initially it was necessary to assess the ability for the PSO method, combined with the energy minimisation ability, for this five repetitions were run with a population size of 96 and 500 (these values were chosen based on the time taken for the \texttt{fitoog} run to complete), with each run taking \num{\sim2.5} hours.
Figure~\ref{fig:realfirst} shows the optimim scattering profile achieved from these \texttt{fitoog} runs.
